#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

BUILD_DIR=${1:-.}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}
BP_DIR=$(cd "$(dirname "${0:-}")"; cd ..; pwd)

echo $BUILD_DIR
echo $CACHE_DIR
echo $ENV_DIR
echo $BP_DIR

HEROKU_BIN_DIR=$BUILD_DIR/.heroku/bin
mkdir -p $BUILD_DIR/.heroku/{bin,cache}

curl -L https://github.com/denoland/deno/releases/download/v0.12.0/deno_linux_x64.gz -o $HEROKU_BIN_DIR/deno.gz
gzip -fd $HEROKU_BIN_DIR/deno.gz
chmod 700 $HEROKU_BIN_DIR/deno

PROFILE_PATH="$BUILD_DIR/.profile.d/deno.sh"
mkdir -p $(dirname $PROFILE_PATH)
echo 'export PATH="$HOME/.heroku/bin:$PATH"' >> $PROFILE_PATH
echo 'export DENO_DIR="$HOME/.heroku/cache"' >> $PROFILE_PATH


pwd
ls -la

$HEROKU_BIN_DIR/deno fetch $BUILD_DIR/app.ts

echo "end of compile"





